<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>09.スクリプトプロセッサーの使い方</title>
    <style type="text/css">
    body { font-family: Arial; }
    </style>
  </head>
  <body>
    <h1>Script Processor</h1>
    <h3>09.スクリプトプロセッサーの使い方</h3>
    <img src="images/scrproc.png"/><br/>
    <button onclick="Play()">Play</button>
    <script type="text/javascript">

    var bufsize = 1024;
    var play = 0;

    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    var audioctx = new AudioContext();

    var scrproc = audioctx.createScriptProcessor(bufsize);
    // #1 関数 Process を onaudioprocess とする
    
    // #2 scrproc を AudioContextに接続をする

    var osc = null;

    function Process(ev) {
        var buf0 = ev.outputBuffer.getChannelData(0);

        // #3 buf1 を ev の channeldata(1) とする

        for(var i = 0; i < bufsize; ++i)
        buf0[i] = buf1[i] = (Math.random() - 0.5) * play;
    }

    function Play() {
        if(play) {
            if(osc)
            osc.stop(0);
            play = 0;
        }
        else {
            if(typeof(audioctx.createOscillator)!=="undefined") {
                // #4 変数名を osc として oscillator nodeを作成

                // #5 osc(oscillator node)を scrproc に接続

                // #6 osc(oscillator node)を start

            }
            play = 1;
        }
    }
    </script>
  </body>
</html>


